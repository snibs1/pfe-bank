================================================================================
PROJECT: NB BANK IA - CREDIT RISK PREDICTION SYSTEM
================================================================================

QUICK OVERVIEW
================================================================================
Project Name: NB BANK IA
Purpose: Automated loan approval/rejection prediction using Machine Learning
Type: Full-Stack Web Application (Fintech)
Tech: Flask + PostgreSQL + XGBoost + Bootstrap 5
Status: Production-ready with Docker containerization
Users: Bank credit officers, loan managers, risk assessment teams


PROJECT DESCRIPTION
================================================================================
NB BANK IA is an intelligent credit risk assessment system that automates loan 
approval decisions. The system accepts client financial information through a 
web interface, processes it through a trained XGBoost machine learning model, 
and provides real-time approval/rejection predictions with risk scoring. All 
data is persisted in a PostgreSQL database with a professional dashboard for 
risk oversight.


TECHNOLOGY STACK
================================================================================
Backend:
- Framework: Flask (Python micro web framework)
- Database: PostgreSQL (production) / SQLite (development)
- ORM: Flask-SQLAlchemy
- ML Libraries: XGBoost, scikit-learn, LightGBM, NumPy, Pandas
- Model Storage: joblib (pickle serialization)
- Server: Flask development server (production uses Docker + uWSGI)

Frontend:
- HTML Templates: Jinja2 templating engine
- CSS Framework: Bootstrap 5.3.0 with custom styling
- JavaScript: Vanilla JS (no frameworks)
- Icons: Bootstrap Icons v1.11.1
- Typography: Google Fonts (Inter)

Containerization:
- Docker with docker-compose for orchestration
- Two services: PostgreSQL database + Flask web application
- Automatic container networking and volume management


DATABASE SCHEMA
================================================================================
Table: simulations
- id (Integer, PK): Unique identifier
- client_name (String[100], NOT NULL): Full name of client
- cin (String[20]): National ID/CIN number
- phone (String[20]): Contact phone number
- annual_income (Float): Yearly revenue
- credit_score (Integer): Credit history score (300-850)
- loan_amount (Float): Requested loan amount
- loan_term (Integer): Repayment period in months
- interest_rate (Float): Interest rate percentage
- risk_score (Float, NOT NULL): AI-predicted risk percentage (0-100)
- status (String[20], NOT NULL): "Approved" or "Rejected"
- date_added (DateTime): Timestamp of record creation

No relationships defined (standalone table for simplicity)


CORE FEATURES
================================================================================

1. AUTHENTICATION & LOGIN
   Route: GET  / → login page
   Route: POST /login → credential validation
   Credentials: username="admin", password="1234"
   Description: Basic HTTP form authentication

2. DASHBOARD - CONTROL CENTER
   Route: GET /dashboard
   Displays:
   - Total number of clients in database
   - Count of high-risk clients (risk_score > 50%)
   - Total loan volume in millions (sum of all loan_amount)
   - Model accuracy badge (91.2% - hardcoded)
   - Last 5 simulations ordered by date
   - Navigation sidebar (Dashboard, AI Simulation, Base Clients)
   - System status indicator (always "Online")

3. AI SIMULATION LAB - PREDICTION INTERFACE
   Route: GET  /simulation → display prediction form
   Route: POST /predict → process prediction
   
   Collects:
   - Personal Info: client_name, cin, phone
   - Financial Metrics: annual_income, debt_to_income_ratio, credit_score,
                        loan_amount, loan_term, interest_rate
   - Categorical: gender, marital_status, education_level, employment_status,
                  loan_purpose
   
   Processing:
   1. Receive form data
   2. Convert categorical features to binary (0/1)
   3. Create feature array with 13 elements
   4. Pad features if necessary
   5. Scale features using StandardScaler
   6. Feed to XGBoost model
   7. Generate binary prediction + probability
   8. Determine final status: "Approved" (pred=0) or "Rejected" (pred=1)
   9. Calculate rejection reason
   10. Save record to database
   
   Returns: JSON with status, risk_score, and reason

4. CLIENT DATABASE / REQUESTS LIST
   Route: GET /requests
   Displays: All clients ordered by date descending
   Features: Full client listing, navigation to individual details

5. CLIENT DETAIL VIEW
   Route: GET /client/<int:id>
   Displays: Complete information for one client
   Includes: Personal info, financial metrics, assessment results, timestamp

6. TEST DATA GENERATION
   Route: POST /generate_test_clients
   Generates: 10 realistic Moroccan client records
   Includes: Random names, financial profiles, ML predictions
   Dates: Within last 30 days (randomized)
   Purpose: Quickly populate database for testing


MACHINE LEARNING MODEL
================================================================================
Model Type: XGBoost (eXtreme Gradient Boosting)
Task: Binary Classification
Output Classes: 0 = Approved, 1 = Rejected

Input Features (13 total):
1. annual_income (numerical) - Yearly revenue
2. debt_to_income_ratio (numerical) - % income used for debt
3. credit_score (numerical) - Credit history score
4. loan_amount (numerical) - Requested amount
5. interest_rate (numerical) - Interest percentage
6. gender_encoded (binary) - 0/1 for categorical variable
7. marital_status_encoded (binary) - 0/1 for categorical variable
8. education_level_encoded (binary) - 0/1 for categorical variable
9. employment_status_encoded (binary) - 0/1 for categorical variable
10. loan_purpose_encoded (binary) - 0/1 for categorical variable
11-13. Fixed binary features (1, 0, 1) - Placeholder/padding

Processing Pipeline:
Input Data → StandardScaler.transform() → XGBoost.predict() 
→ Probability Extraction → Decision Output (Approved/Rejected)

Output:
- Binary Prediction: 0 or 1
- Probability Score: % risk (0-100)
- Final Status: "Approved" or "Rejected"

Model Files:
- loan_prediction_model.pkl (XGBoost model object)
- data_scaler.pkl (StandardScaler for normalization)

Both loaded at application startup via joblib.load()


PROJECT STRUCTURE
================================================================================
pfe/
├── app.py                    # Main Flask app (7 routes, 170 lines)
├── config.py                 # Config settings (8 lines)
├── models.py                 # Database model (22 lines)
├── requirements.txt          # Dependencies (9 packages)
├── Dockerfile               # Container definition
├── docker-compose.yml       # Two-service orchestration
├── loan_prediction_model.pkl # Trained XGBoost model
├── data_scaler.pkl          # StandardScaler
├── bank_data.db             # SQLite database (dev)
│
├── templates/               # Jinja2 HTML templates
│   ├── login.html          # Login interface
│   ├── dashboard.html      # Main dashboard base template
│   ├── simulation.html     # Prediction form
│   ├── requests.html       # Client list
│   ├── client_detail.html  # Individual client profile
│   ├── predict.html        # Results page
│   └── history.html        # Historical viewer
│
└── static/                 # CSS & JavaScript assets
    ├── css/
    │   ├── login.css
    │   ├── dashboard.css
    │   ├── simulation.css
    │   ├── requests.css
    │   ├── client_detail.css
    │   └── style.css
    └── js/
        ├── login.js        # Form validation
        ├── dashboard.js    # Dashboard interactions
        ├── simulation.js   # Form submission & AJAX
        ├── requests.js     # Client list filtering
        └── client_detail.js


API ENDPOINTS SUMMARY
================================================================================
GET  /                    Login page (form display)
POST /login               User authentication (form-based)
GET  /dashboard           Main dashboard (stats & overview)
GET  /simulation          Prediction form interface
GET  /requests            Display all clients
POST /predict             Process ML prediction (AJAX)
GET  /client/<int:id>     Individual client details
POST /generate_test_clients  Generate 10 test records

Response Format: HTML templates for page routes, JSON for AJAX requests


CONFIGURATION DETAILS
================================================================================
config.py Settings:
- SECRET_KEY: "nb_bank_2026_secure_key"
- BASE_DIR: Project root directory
- SQLALCHEMY_DATABASE_URI: PostgreSQL or SQLite
- SQLALCHEMY_TRACK_MODIFICATIONS: False

Docker Environment Variables:
- DATABASE_URL: postgresql://admin:pfe_password@db:5432/bank_warehouse
- POSTGRES_USER: admin
- POSTGRES_PASSWORD: pfe_password
- POSTGRES_DB: bank_warehouse
- FLASK_APP: app.py


DOCKER DEPLOYMENT
================================================================================
Two-Container Architecture:

Container 1: bank_postgres (PostgreSQL Database)
- Image: postgres:15
- Port: 5432
- User: admin
- Password: pfe_password
- Database: bank_warehouse
- Volume: postgres_data (persistent)

Container 2: credit_risk_app (Flask Application)
- Image: python:3.9-slim (custom built)
- Port: 5000
- Dependencies: Waits for PostgreSQL
- Build: Dockerfile (installs dependencies, copies code)
- System packages: libgomp1, libpq-dev, gcc

Docker Compose Features:
- Automatic service discovery
- Environment variable injection
- Volume persistence
- Network isolation
- Single command deployment


PYTHON DEPENDENCIES
================================================================================
flask                   # Web microframework
flask-sqlalchemy        # ORM and database toolkit
numpy                   # Numerical computing
scikit-learn           # ML algorithms and preprocessing
xgboost                # Gradient boosting library
lightgbm               # Light gradient boosting (alternative)
joblib                 # Model and array serialization
pandas                 # Data manipulation (optional)
psycopg2-binary        # PostgreSQL driver for Python


DATA FLOW EXAMPLE - PREDICTION WORKFLOW
================================================================================
1. User navigates to /simulation
2. Fills out form with client financial information
3. JavaScript collects form data
4. AJAX POST request to /predict endpoint
5. Flask receives form data as request.form
6. Extract 13 features from form fields
7. Convert categorical values to binary (0/1)
8. Create NumPy array: features = [income, dti, credit, loan, rate, ...]
9. Apply padding if necessary (match scaler feature count)
10. StandardScaler.transform(features) → normalized features
11. XGBoost.predict(normalized_features) → binary prediction
12. XGBoost.predict_proba() → risk probability percentage
13. Determine final_status based on prediction
14. Create Simulation database record
15. db.session.add(record) and db.session.commit()
16. Return JSON: {"status": "Approved", "risk_score": 25.5, "reason": "..."}
17. JavaScript displays result to user


USER INTERFACE COMPONENTS
================================================================================
Login Page:
- Animated gradient backgrounds
- Logo and branding section
- Feature showcase (XGBoost, Speed, Security)
- Form: username and password inputs
- Error flash messages

Sidebar Navigation:
- Logo section (NB BANK IA with icon)
- Status indicator (System Online)
- Three nav items: Dashboard, AI Simulation, Base Clients
- Logout button

Dashboard Stats:
- Total Clients card
- High-Risk Clients card
- Total Loan Volume card
- Model Accuracy badge
- Recent Simulations table (5 rows)

AI Simulation Form:
- Civil section: Name, CIN, Phone
- Financial section: Income, DTI, Credit Score
- Loan section: Amount, Term, Interest Rate
- Profile section: Gender, Status, Education, Employment, Purpose
- Results display: Decision with risk score and reason

Client Detail View:
- Full personal and financial information
- Risk assessment results
- Status and timestamp
- Navigation links

Color Scheme:
- Dark theme (grays and dark blues)
- Accent colors: Cyan/Info blue
- Icons: Bootstrap Icons throughout
- Responsive: Bootstrap 5 grid system


SECURITY CONSIDERATIONS
================================================================================
Current Implementation:
- Basic form-based authentication
- Hardcoded admin credentials (demo only)
- SQLAlchemy ORM prevents SQL injection
- No HTTPS
- No rate limiting
- No CSRF tokens

Production Recommendations:
- Implement JWT or OAuth2
- Use environment variables for credentials
- Enable HTTPS/SSL
- Add rate limiting
- Implement request validation
- Hash passwords with bcrypt
- Add CSRF protection
- Use secure session cookies
- Implement proper audit logging


DEPLOYMENT & STARTUP INSTRUCTIONS
================================================================================
Local Development:
1. pip install -r requirements.txt
2. python app.py
3. Open http://localhost:5000
4. Login with admin/1234

Docker Production:
1. docker-compose up --build
2. Models and database initialize automatically
3. Access http://localhost:5000
4. Both services run in background
5. Data persists in Docker volumes

Startup Sequence:
- Load Flask configuration
- Load XGBoost model from disk
- Load StandardScaler from disk
- Initialize SQLAlchemy
- Create database tables if not exist
- Print "✅ NB BANK: System Ready & AI Models Loaded"
- Start Flask development server


KEY STATISTICS & METRICS
================================================================================
Model Accuracy: 91.2% (displayed on dashboard)
Feature Count: 13 input features
Classification Type: Binary (Approved/Rejected)
Prediction Response Time: <1 second
Database Scalability: Unlimited records (PostgreSQL)
Concurrent Users: 1+ (development server, scalable with production WSGI)
Default Test Clients: 10 records per generation
Risk Score Range: 0-100 (percentage)
High-Risk Threshold: risk_score > 50%


TYPICAL USER WORKFLOW
================================================================================
1. Access http://localhost:5000
2. Login with credentials (admin/1234)
3. Dashboard displays system overview
4. View recent predictions and key metrics
5. Click "AI Simulation" to assess new client
6. Fill out client financial form
7. System processes ML prediction
8. View approval decision and risk score
9. Record automatically saved to database
10. Browse "Base Clients" to view all assessments
11. Click client card to view complete details
12. Use "Historique" button to view past analyses
13. Generate test clients for demo purposes
14. Logout when finished


TEMPLATE INHERITANCE & STRUCTURE
================================================================================
All templates extend dashboard.html as base template:
- Consistent sidebar navigation
- Bootstrap 5 grid system
- Icon sets (Bootstrap Icons)
- Jinja2 variables for dynamic content
- AJAX endpoints for asynchronous requests
- Form validation (client and server side)


ADDITIONAL FEATURES
================================================================================
1. Test Data Generator
   - Generates 10 realistic Moroccan clients instantly
   - Includes random financial profiles
   - Automatic ML predictions for each
   - Dates randomized within last 30 days
   - Single POST request trigger

2. Flash Messaging
   - Real-time error notifications
   - Success/danger alerts
   - Login failure messages

3. Auto-Model Loading
   - Models loaded at startup (not per request)
   - Improves performance (eliminates disk I/O)
   - Error handling if models missing

4. Feature Padding
   - Ensures consistent feature matrix size
   - Pads with zeros if needed
   - Handles model/scaler mismatch


LEARNING OUTCOMES FROM THIS PROJECT
================================================================================
✓ Full-stack web application development (Flask + Bootstrap)
✓ Machine learning model integration in production
✓ Database design and ORM usage (SQLAlchemy)
✓ Docker containerization and orchestration
✓ HTML form processing and validation
✓ AJAX/REST API patterns
✓ Data persistence strategies
✓ User authentication and access control
✓ Feature engineering for ML
✓ Professional UI/UX design


PROJECT STRENGTHS
================================================================================
✓ Production-ready with Docker
✓ Real-time ML predictions
✓ Professional UI/UX with Bootstrap
✓ Complete data persistence
✓ Clear project structure
✓ Proper separation of concerns
✓ Scalable database (PostgreSQL)
✓ Realistic banking scenarios
✓ Test data generation for demos


AREAS FOR ENHANCEMENT
================================================================================
○ Role-based access control (RBAC)
○ User registration and account management
○ API rate limiting and protection
○ Advanced audit logging
○ Model performance monitoring
○ A/B testing framework for model versions
○ Client file export/import
○ Advanced analytics dashboard
○ Webhook support for external integration
○ Real-time notifications


PROJECT SUMMARY
================================================================================
NB BANK IA is a complete, production-ready credit risk assessment system that
demonstrates full-stack web development, machine learning integration, database
management, and containerization. It automates loan approval decisions using
XGBoost, provides a professional dashboard for oversight, and can be easily
deployed using Docker.

Perfect for: Portfolio projects, fintech learning, loan management systems,
credit risk assessment MVPs, banking software demonstrations.

Status: PRODUCTION READY ✅
Last Updated: February 2026

================================================================================
